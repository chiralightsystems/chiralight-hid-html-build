(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();const e=e=>document.querySelector(e);var t=`Controller not connected.`,n=3e3,r=1155,i=null,a=e=>new Promise(async(r,a)=>{if(i===null){a(t);return}let o=e=>{c(),r(e.data)},s=()=>{c(),a(`^C`)},c=()=>{clearTimeout(l),i?.removeEventListener(`inputreport`,o),j(s)},l=setTimeout(()=>{c(),a(`Request timed out after ${n}ms.`)},n);A(s),i.addEventListener(`inputreport`,o),await i.sendReport(0,e)}),o=()=>new Promise(async(e,n)=>{if(i===null){n(t);return}let r=()=>{a(),n(`^C`)},a=()=>{i?.removeEventListener(`inputreport`,o),j(r)},o=t=>{a(),e(t.data)};A(r),i.addEventListener(`inputreport`,o)}),s=async()=>(i=(await window.navigator.hid.requestDevice({filters:[{vendorId:r}]}))[0]||null,i===null?!1:(await i.open(),!0)),c=async()=>i===null?!1:(await i.close(),i=null,!0),l=(e,t)=>({dataType:e,optional:t}),u={help:{0:l(`string`)},connect:{},disconnect:{},SendBytes:{0:l(`u8[]`,!0)},ReceiveBytes:{limit:l(`u64`,!0),output:l(`string`,!0)}},d=`% `,f=`chiralight-hid % `,p=`input-before`,m=`input-cursor`,h=`terminal-line`,g=e(`#terminal`),_=null,v=[``,``],y=[``,``],b=null,x=[],S=()=>i===null?d:f,C=e=>/^\d+$/.test(e),w=()=>v.join(``),T=()=>w().split(/\s+/),E=()=>v[0].split(/\s+/).length-1;function D(e,t){let n=window.localStorage.getItem(e);if(n===null){if(t===void 0)return null;let r=JSON.stringify(t);window.localStorage.setItem(e,r),n=r}return JSON.parse(n)}var O=(e,t)=>(window.localStorage.setItem(e,JSON.stringify(t)),t),k=async()=>{await Promise.all(x.map(e=>e())),x=[]},A=e=>{x.push(e)},j=e=>{let t=x.findIndex(t=>t===e);t!==-1&&x.splice(t,1)},M=D(`history`,[]),N=e=>{M.push(e),O(`history`,M)},P=e=>{let t=M.length-1;if(b===null&&(b=t+1,y=[v.join(``),``]),b+=e,b>t){b=null,v=[...y],y=[``,``],q();return}b=Math.max(0,Math.min(b,t)),v=[M[b]||``,``],q()},F=(e,t)=>{let n=e===`help`?`CommandName`:Object.entries(t).map(([e,t])=>{let n=t.dataType,r=/(.*)\[\]/;if(r.test(n)){let e=r.exec(n)[1];n=`${e} ${e} ${e} ...`}let i=C(e)?n:`--${e} ${n}`;return t.optional?`[${i}]`:i}).join(` `);return`<span style="color: #ffaaff">NAME</span>
${e}

<span style="color: #ffaaff">USAGE</span>
${e} ${n}

`},I=()=>{let[e,...t]=T();if(e===void 0||e===``)return`No input`;let n=[],r={},i=null;for(let e of t)if(e!==``){if(e.startsWith(`--`)){i=e.slice(2),r[i]=[];continue}if(i===null){n.push(e);continue}r[i].push(e)}return{name:e,positionalArgs:n,namedArgs:r}},L=async e=>{switch(e.name){case`help`:{let t=e.positionalArgs[0]||`help`,n=u[t];if(n===void 0){Q(`Command not found: ${t}`);break}let r=F(t,n);Q(r);break}case`connect`:try{await s()||Q(`No controller selected.`)}catch(e){e instanceof Error&&Q(`Error: ${e.message}`)}break;case`disconnect`:try{await c()||Q(t)}catch(e){e instanceof Error&&Q(`Error: ${e.message}`)}break;case`SendBytes`:{let t=[];for(let n=0;n<64;n++){let r=e.positionalArgs[n];t[n]=r===void 0?0:parseInt(r,10)}let n=new Uint8Array(t);try{let e=await a(n),t=[];for(let n=0;n<e.byteLength;n++)t[n]=e.getUint8(n).toString(10).toUpperCase();Q(t.join(` `))}catch(e){typeof e==`string`&&Q(e)}break}case`ReceiveBytes`:try{let t=[[`Data`,`Timestamp`]],n=e.namedArgs.output?.[0],r=e.namedArgs.limit?.[0],i=r===void 0?1/0:parseInt(r,10),a=!1,s=()=>{a=!0};A(s);for(let e=0;e<i&&!a;e++){let e=await o(),r=[];for(let t=0;t<e.byteLength;t++)r[t]=e.getUint8(t).toString(10).toUpperCase();let i=r.join(` `);n!==void 0&&t.push([i,Date.now().toString(10)]),Q(i)}if(j(s),n!==void 0&&t.length>0){let e=`data:text/csv;charset=utf-8,`+t.map(e=>e.join(`,`)).join(`
`),r=encodeURI(e),i=document.createElement(`a`);i.setAttribute(`href`,r),i.setAttribute(`download`,n),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}catch(e){typeof e==`string`&&Q(e)}break;default:Q(`Unknown command: ${e.name}`);break}},R=async()=>{let e=v.join(``).trim();if(Z(),$(e),e){N(e),b=null;let t=I();typeof t==`string`?Q(t):await L(t)}v=[``,``],X(),q()},z=e=>e.replaceAll(`&`,`&amp;`).replaceAll(`<`,`&lt;`).replaceAll(`>`,`&gt;`).replaceAll(`"`,`&quot;`).replaceAll(`'`,`&#039;`),B=e=>{v[0]+=z(e),q()},V=()=>{let e=v[0],t=e.length-1;/&[^;]*;$/.test(e)&&(t=e.split(``).findLastIndex(e=>e===`&`)),v[0]=e.slice(0,t),q()},H=()=>{let e=w(),t=v[0].length+1;if(e[t-1]===`&`&&/^&[^;]*;/.test(v[1]))for(;e[t-1]!==`;`;t++);v=[e.slice(0,t),e.slice(t)],q()},U=()=>{let e=w(),t=Math.max(0,v[0].length-1);if(e[t]===`;`&&/&[^;]*;$/.test(v[0]))for(;e[t]!==`&`;t--);v=[e.slice(0,t),e.slice(t)],q()},W=e=>{let t=T(),n=t[0],r=Object.keys(u);if(n===void 0)return r;if(e===0)return r.filter(e=>e.startsWith(n));if(n===`help`&&e===1)return r.filter(e=>e.startsWith(t[1]||``));let i=u[n];if(i===void 0)return[];let a=new Set(Object.keys(i).filter(e=>!C(e))),o=t[e];for(let e of t){if(e===o||!e.startsWith(`--`))continue;let t=e.slice(2);a.delete(t)}let s=[...a].map(e=>`--${e}`);return o.startsWith(`-`)?s.filter(e=>e.startsWith(o)):s},G=(e,t)=>{let n=T(),r=n.slice(0,t),i=n.slice(t+1);return[[...r,e].join(` `)+(i.length>0?` `:``),i.join(` `)]},K=()=>v=[v[0].trimStart().split(/\s+/).join(` `),v[1].split(/\s+/).join(` `)],q=()=>{if(_===null)return;K();let e=`<span id="${p}">${v[0]}<span id="${m}">&nbsp;</span></span>`,t=`<span>${v[1]}</span>`;_.innerHTML=`${e}${t}`,_.scrollIntoView({behavior:`instant`})},J=e=>{if(e.ctrlKey&&e.key===`c`){k();return}if(!(e.altKey||e.metaKey||e.ctrlKey))switch(e.key){case`Enter`:e.stopPropagation(),e.preventDefault(),R();break;case`Backspace`:e.stopPropagation(),e.preventDefault(),V();break;case`ArrowLeft`:e.stopPropagation(),e.preventDefault(),U();break;case`ArrowRight`:e.stopPropagation(),e.preventDefault(),H();break;case`ArrowUp`:e.stopPropagation(),e.preventDefault(),P(-1);break;case`ArrowDown`:e.stopPropagation(),e.preventDefault(),P(1);break;case`Tab`:{e.stopPropagation(),e.preventDefault();let t=E(),n=W(t);if(n.length===0)break;if(n.length===1){v=G(n[0],t),q();break}let r=w();Z(),$(r),Q(n.join(` `)),X(),q();break}case`Shift`:break;case`Escape`:break;case`CapsLock`:break;default:B(e.key);break}},Y=e=>{e.stopPropagation(),e.preventDefault();let t=e.clipboardData?.getData(`text/plain`);t!==void 0&&B(t)},X=()=>{let e=document.createElement(`span`);e.className=h;let t=document.createElement(`span`);t.innerHTML=`${S()}`,e.appendChild(t),_=document.createElement(`span`),_.addEventListener(`keydown`,J),e.appendChild(_),g.appendChild(e),_.focus()},Z=()=>{_?.removeEventListener(`keydown`,J),_?.parentElement?.remove(),_=null},Q=e=>{let t=document.createElement(`span`);t.className=h,t.innerHTML=e,g.appendChild(t)},$=e=>{Q(`${S()}${e}`)};document.body.addEventListener(`keydown`,J),document.body.addEventListener(`paste`,Y),X(),q();