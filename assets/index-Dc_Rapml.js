(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();const e=e=>document.querySelector(e);var t=`Controller not connected.`,n=3e3,r=1155,i=null,a=e=>new Promise(async(r,a)=>{if(i===null){a(t);return}let o=e=>{clearTimeout(s),i?.removeEventListener(`inputreport`,o),r(e.data)},s=setTimeout(()=>{i?.removeEventListener(`inputreport`,o),a(`Request timed out after ${n}ms.`)},n);i.addEventListener(`inputreport`,o),await i.sendReport(0,e)}),o=async()=>(i=(await window.navigator.hid.requestDevice({filters:[{vendorId:r}]}))[0]||null,i===null?!1:(await i.open(),!0)),s=async()=>i===null?!1:(await i.close(),i=null,!0),c=(e,t)=>({dataType:e,optional:t}),l={help:{0:c(`string`)},connect:{},disconnect:{},SendBytes:{0:c(`u8[]`,!0)}},u=`% `,d=`chiralight-hid % `,f=`input-before`,p=`input-cursor`,m=`terminal-line`,h=e(`#terminal`),g=null,_=[``,``],v=[``,``],y=null,b=()=>i===null?u:d,x=e=>/^\d+$/.test(e),S=()=>_.join(``),C=()=>S().split(/\s+/),w=()=>_[0].split(/\s+/).length-1;function T(e,t){let n=window.localStorage.getItem(e);if(n===null){if(t===void 0)return null;let r=JSON.stringify(t);window.localStorage.setItem(e,r),n=r}return JSON.parse(n)}var E=(e,t)=>(window.localStorage.setItem(e,JSON.stringify(t)),t),D=T(`history`,[]),O=e=>{D.push(e),E(`history`,D)},k=e=>{let t=D.length-1;if(y===null&&(y=t+1,v=[_.join(``),``]),y+=e,y>t){y=null,_=[...v],v=[``,``],H();return}y=Math.max(0,Math.min(y,t)),_=[D[y]||``,``],H()},A=(e,t)=>{let n=Object.entries(t).map(([e,t])=>{let n=t.dataType,r=/(.*)\[\]/;if(r.test(n)){let e=r.exec(n)[1];n=`${e} ${e} ${e} ...`}let i=x(e)?n:`--${e} ${n}`;return t.optional?`[${i}]`:i}).join(` `);return`<span style="color: #ffaaff">NAME</span>
${e}

<span style="color: #ffaaff">USAGE</span>
${e} ${n}

`},j=()=>{let[e,...t]=C();if(e===void 0||e===``)return`No input`;let n=[],r={},i=null;for(let e of t)if(e!==``){if(e.startsWith(`--`)){i=e.slice(2),r[i]=[];continue}if(i===null){n.push(e);continue}r[i].push(e)}return{name:e,positionalArgs:n,namedArgs:r}},M=async e=>{switch(e.name){case`help`:{let t=e.positionalArgs[0]||`help`,n=l[t];if(n===void 0){q(`Command not found: ${t}`);break}let r=A(t,n);q(r);break}case`connect`:try{await o()||q(`No controller selected.`)}catch(e){e instanceof Error&&q(`Error: ${e.message}`)}break;case`disconnect`:try{await s()||q(t)}catch(e){e instanceof Error&&q(`Error: ${e.message}`)}break;case`SendBytes`:{let t=[];for(let n=0;n<64;n++){let r=e.positionalArgs[n];t[n]=r===void 0?0:parseInt(r,10)}let n=new Uint8Array(t);try{let e=await a(n),t=[];for(let n=0;n<e.byteLength;n++)t[n]=e.getUint8(n).toString(10).toUpperCase();q(t.join(` `))}catch(e){typeof e==`string`&&q(e)}break}default:q(`Unknown command: ${e.name}`);break}},N=async()=>{let e=_.join(``).trim();if(K(),J(e),e){O(e),y=null;let t=j();typeof t==`string`?q(t):await M(t)}_=[``,``],G(),H()},P=e=>e.replaceAll(`&`,`&amp;`).replaceAll(`<`,`&lt;`).replaceAll(`>`,`&gt;`).replaceAll(`"`,`&quot;`).replaceAll(`'`,`&#039;`),F=e=>{_[0]+=P(e),H()},I=()=>{let e=_[0],t=e.length-1;/&[^;]*;$/.test(e)&&(t=e.split(``).findLastIndex(e=>e===`&`)),_[0]=e.slice(0,t),H()},L=()=>{let e=S(),t=_[0].length+1;if(e[t-1]===`&`&&/^&[^;]*;/.test(_[1]))for(;e[t-1]!==`;`;t++);_=[e.slice(0,t),e.slice(t)],H()},R=()=>{let e=S(),t=Math.max(0,_[0].length-1);if(e[t]===`;`&&/&[^;]*;$/.test(_[0]))for(;e[t]!==`&`;t--);_=[e.slice(0,t),e.slice(t)],H()},z=e=>{let t=C(),n=t[0],r=Object.keys(l);if(n===void 0)return r;if(e===0)return r.filter(e=>e.startsWith(n));if(n===`help`&&e===1)return r.filter(e=>e.startsWith(t[1]||``));let i=l[n];if(i===void 0)return[];let a=new Set(Object.keys(i).filter(e=>!x(e))),o=t[e];for(let e of t){if(e===o||!e.startsWith(`--`))continue;let t=e.slice(2);a.delete(t)}let s=[...a].map(e=>`--${e}`);return o.startsWith(`-`)?s.filter(e=>e.startsWith(o)):s},B=(e,t)=>{let n=C(),r=n.slice(0,t),i=n.slice(t+1);return[[...r,e].join(` `)+(i.length>0?` `:``),i.join(` `)]},V=()=>_=[_[0].trimStart().split(/\s+/).join(` `),_[1].split(/\s+/).join(` `)],H=()=>{if(g===null)return;V();let e=`<span id="${f}">${_[0]}<span id="${p}">&nbsp;</span></span>`,t=`<span>${_[1]}</span>`;g.innerHTML=`${e}${t}`,g.scrollIntoView({behavior:`instant`})},U=e=>{if(!(e.altKey||e.metaKey||e.ctrlKey))switch(e.key){case`Enter`:e.stopPropagation(),e.preventDefault(),N();break;case`Backspace`:e.stopPropagation(),e.preventDefault(),I();break;case`ArrowLeft`:e.stopPropagation(),e.preventDefault(),R();break;case`ArrowRight`:e.stopPropagation(),e.preventDefault(),L();break;case`ArrowUp`:e.stopPropagation(),e.preventDefault(),k(-1);break;case`ArrowDown`:e.stopPropagation(),e.preventDefault(),k(1);break;case`Tab`:{e.stopPropagation(),e.preventDefault();let t=w(),n=z(t);if(n.length===0)break;if(n.length===1){_=B(n[0],t),H();break}let r=S();K(),J(r),q(n.join(` `)),G(),H();break}case`Shift`:break;case`Escape`:break;case`CapsLock`:break;default:F(e.key);break}},W=e=>{e.stopPropagation(),e.preventDefault();let t=e.clipboardData?.getData(`text/plain`);t!==void 0&&F(t)},G=()=>{let e=document.createElement(`span`);e.className=m;let t=document.createElement(`span`);t.innerHTML=`${b()}`,e.appendChild(t),g=document.createElement(`span`),g.addEventListener(`keydown`,U),e.appendChild(g),h.appendChild(e),g.focus()},K=()=>{g?.removeEventListener(`keydown`,U),g?.parentElement?.remove(),g=null},q=e=>{let t=document.createElement(`span`);t.className=m,t.innerHTML=e,h.appendChild(t)},J=e=>{q(`${b()}${e}`)};document.body.addEventListener(`keydown`,U),document.body.addEventListener(`paste`,W),G(),H();