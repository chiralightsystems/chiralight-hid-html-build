(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();const e=e=>document.querySelector(e);var t=`Controller not connected.`,n=3e3,r=null,i=e=>new Promise(async(i,a)=>{if(r===null){a(t);return}let o=e=>{clearTimeout(s),r?.removeEventListener(`inputreport`,o),i(e.data)},s=setTimeout(()=>{r?.removeEventListener(`inputreport`,o),a(`Request timed out after ${n}ms.`)},n);r.addEventListener(`inputreport`,o),await r.sendReport(0,e)}),a=async()=>(r=(await window.navigator.hid.requestDevice({filters:[]}))[0]||null,r===null?!1:(await r.open(),!0)),o=async()=>r===null?!1:(await r.close(),r=null,!0),s=(e,t)=>({dataType:e,optional:t}),c={help:{0:s(`string`)},connect:{},disconnect:{},SendBytes:{0:s(`u8[]`,!0)}},l=`% `,u=`chiralight-hid % `,d=`input-before`,f=`input-cursor`,p=`terminal-line`,m=e(`#terminal`),h=null,g=[``,``],_=[``,``],v=null,y=()=>r===null?l:u,b=e=>/^\d+$/.test(e),x=()=>g.join(``),S=()=>x().split(/\s+/),C=()=>g[0].split(/\s+/).length-1;function w(e,t){let n=window.localStorage.getItem(e);if(n===null){if(t===void 0)return null;let r=JSON.stringify(t);window.localStorage.setItem(e,r),n=r}return JSON.parse(n)}var T=(e,t)=>(window.localStorage.setItem(e,JSON.stringify(t)),t),E=w(`history`,[]),D=e=>{E.push(e),T(`history`,E)},O=e=>{let t=E.length-1;if(v===null&&(v=t+1,_=[g.join(``),``]),v+=e,v>t){v=null,g=[..._],_=[``,``],V();return}v=Math.max(0,Math.min(v,t)),g=[E[v]||``,``],V()},k=(e,t)=>{let n=Object.entries(t).map(([e,t])=>{let n=t.dataType,r=/(.*)\[\]/;if(r.test(n)){let e=r.exec(n)[1];n=`${e} ${e} ${e} ...`}let i=b(e)?n:`--${e} ${n}`;return t.optional?`[${i}]`:i}).join(` `);return`<span style="color: #ffaaff">NAME</span>
${e}

<span style="color: #ffaaff">USAGE</span>
${e} ${n}

`},A=()=>{let[e,...t]=S();if(e===void 0||e===``)return`No input`;let n=[],r={},i=null;for(let e of t)if(e!==``){if(e.startsWith(`--`)){i=e.slice(2),r[i]=[];continue}if(i===null){n.push(e);continue}r[i].push(e)}return{name:e,positionalArgs:n,namedArgs:r}},j=async e=>{switch(e.name){case`help`:{let t=e.positionalArgs[0]||`help`,n=c[t];if(n===void 0){K(`Command not found: ${t}`);break}let r=k(t,n);K(r);break}case`connect`:try{await a()||K(`No controller selected.`)}catch(e){e instanceof Error&&K(`Error: ${e.message}`)}break;case`disconnect`:try{await o()||K(t)}catch(e){e instanceof Error&&K(`Error: ${e.message}`)}break;case`SendBytes`:{let t=[];for(let n=0;n<64;n++){let r=e.positionalArgs[n];t[n]=r===void 0?0:parseInt(r,16)}let n=new Uint8Array(t);try{let e=await i(n),t=[];for(let n=0;n<e.byteLength;n++)t[n]=e.getUint8(n).toString(16).toUpperCase();K(t.join(` `))}catch(e){typeof e==`string`&&K(e)}break}default:K(`Unknown command: ${e.name}`);break}},M=async()=>{let e=g.join(``).trim();if(G(),q(e),e){D(e),v=null;let t=A();typeof t==`string`?K(t):await j(t)}g=[``,``],W(),V()},N=e=>e.replaceAll(`&`,`&amp;`).replaceAll(`<`,`&lt;`).replaceAll(`>`,`&gt;`).replaceAll(`"`,`&quot;`).replaceAll(`'`,`&#039;`),P=e=>{g[0]+=N(e),V()},F=()=>{let e=g[0],t=e.length-1;/&[^;]*;$/.test(e)&&(t=e.split(``).findLastIndex(e=>e===`&`)),g[0]=e.slice(0,t),V()},I=()=>{let e=x(),t=g[0].length+1;if(e[t-1]===`&`&&/^&[^;]*;/.test(g[1]))for(;e[t-1]!==`;`;t++);g=[e.slice(0,t),e.slice(t)],V()},L=()=>{let e=x(),t=Math.max(0,g[0].length-1);if(e[t]===`;`&&/&[^;]*;$/.test(g[0]))for(;e[t]!==`&`;t--);g=[e.slice(0,t),e.slice(t)],V()},R=e=>{let t=S(),n=t[0],r=Object.keys(c);if(n===void 0)return r;if(e===0)return r.filter(e=>e.startsWith(n));if(n===`help`&&e===1)return r.filter(e=>e.startsWith(t[1]||``));let i=c[n];if(i===void 0)return[];let a=new Set(Object.keys(i).filter(e=>!b(e))),o=t[e];for(let e of t){if(e===o||!e.startsWith(`--`))continue;let t=e.slice(2);a.delete(t)}let s=[...a].map(e=>`--${e}`);return o.startsWith(`-`)?s.filter(e=>e.startsWith(o)):s},z=(e,t)=>{let n=S(),r=n.slice(0,t),i=n.slice(t+1);return[[...r,e].join(` `)+(i.length>0?` `:``),i.join(` `)]},B=()=>g=[g[0].trimStart().split(/\s+/).join(` `),g[1].split(/\s+/).join(` `)],V=()=>{if(h===null)return;B();let e=`<span id="${d}">${g[0]}<span id="${f}">&nbsp;</span></span>`,t=`<span>${g[1]}</span>`;h.innerHTML=`${e}${t}`,h.scrollIntoView({behavior:`instant`})},H=e=>{if(!(e.altKey||e.metaKey||e.ctrlKey))switch(e.key){case`Enter`:e.stopPropagation(),e.preventDefault(),M();break;case`Backspace`:e.stopPropagation(),e.preventDefault(),F();break;case`ArrowLeft`:e.stopPropagation(),e.preventDefault(),L();break;case`ArrowRight`:e.stopPropagation(),e.preventDefault(),I();break;case`ArrowUp`:e.stopPropagation(),e.preventDefault(),O(-1);break;case`ArrowDown`:e.stopPropagation(),e.preventDefault(),O(1);break;case`Tab`:{e.stopPropagation(),e.preventDefault();let t=C(),n=R(t);if(n.length===0)break;if(n.length===1){g=z(n[0],t),V();break}let r=x();G(),q(r),K(n.join(` `)),W(),V();break}case`Shift`:break;case`Escape`:break;case`CapsLock`:break;default:P(e.key);break}},U=e=>{e.stopPropagation(),e.preventDefault();let t=e.clipboardData?.getData(`text/plain`);t!==void 0&&P(t)},W=()=>{let e=document.createElement(`span`);e.className=p;let t=document.createElement(`span`);t.innerHTML=`${y()}`,e.appendChild(t),h=document.createElement(`span`),h.addEventListener(`keydown`,H),e.appendChild(h),m.appendChild(e),h.focus()},G=()=>{h?.removeEventListener(`keydown`,H),h?.parentElement?.remove(),h=null},K=e=>{let t=document.createElement(`span`);t.className=p,t.innerHTML=e,m.appendChild(t)},q=e=>{K(`${y()}${e}`)};document.body.addEventListener(`keydown`,H),document.body.addEventListener(`paste`,U),W(),V();