(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();const e=e=>document.querySelector(e);var t=`Controller not connected.`,n=3e3,r=1155,i=64,a=Math.floor(i/4),o=null,s=e=>new Promise(async(r,i)=>{if(o===null){i(t);return}let a=e=>{c(),r(e.data)},s=()=>{c(),i(`^C`)},c=()=>{clearTimeout(l),o?.removeEventListener(`inputreport`,a),j(s)},l=setTimeout(()=>{c(),i(`Request timed out after ${n}ms.`)},n);A(s),o.addEventListener(`inputreport`,a),await o.sendReport(0,e)}),c=()=>new Promise(async(e,n)=>{if(o===null){n(t);return}let r=()=>{i(),n(`^C`)},i=()=>{o?.removeEventListener(`inputreport`,a),j(r)},a=t=>{i(),e(t.data)};A(r),o.addEventListener(`inputreport`,a)}),l=async()=>(o=(await window.navigator.hid.requestDevice({filters:[{vendorId:r}]}))[0]||null,o===null?!1:(await o.open(),!0)),ee=async()=>o===null?!1:(await o.close(),o=null,!0),u=(e,t)=>({dataType:e,optional:t}),d={help:{0:u(`string`)},connect:{},disconnect:{},SendBytes:{0:u(`u8[]`,!0)},ReceiveBytes:{limit:u(`u64`,!0),output:u(`string`,!0)}},te=`% `,f=`chiralight-hid % `,ne=`input-before`,p=`input-cursor`,m=`terminal-line`,h=e(`#terminal`),g=h.scrollTop,_=!0,v=null,y=[``,``],b=[``,``],x=null,S=[],C=()=>o===null?te:f,w=e=>/^\d+$/.test(e),T=()=>y.join(``),E=()=>T().split(/\s+/),re=()=>y[0].split(/\s+/).length-1;function D(e,t){let n=window.localStorage.getItem(e);if(n===null){if(t===void 0)return null;let r=JSON.stringify(t);window.localStorage.setItem(e,r),n=r}return JSON.parse(n)}var O=(e,t)=>(window.localStorage.setItem(e,JSON.stringify(t)),t),k=async()=>{await Promise.all(S.map(e=>e())),S=[]},A=e=>{S.push(e)},j=e=>{let t=S.findIndex(t=>t===e);t!==-1&&S.splice(t,1)},M=D(`history`,[]),N=e=>{M.push(e),O(`history`,M)},P=e=>{let t=M.length-1;if(x===null&&(x=t+1,b=[y.join(``),``]),x+=e,x>t){x=null,y=[...b],b=[``,``],q();return}x=Math.max(0,Math.min(x,t)),y=[M[x]||``,``],q()},F=(e,t)=>{let n=e===`help`?`CommandName`:Object.entries(t).map(([e,t])=>{let n=t.dataType,r=/(.*)\[\]/;if(r.test(n)){let e=r.exec(n)[1];n=`${e} ${e} ${e} ...`}let i=w(e)?n:`--${e} ${n}`;return t.optional?`[${i}]`:i}).join(` `);return`<span style="color: #ffaaff">NAME</span>
${e}

<span style="color: #ffaaff">USAGE</span>
${e} ${n}

`},I=()=>{let[e,...t]=E();if(e===void 0||e===``)return`No input`;let n=[],r={},i=null;for(let e of t)if(e!==``){if(e.startsWith(`--`)){i=e.slice(2),r[i]=[];continue}if(i===null){n.push(e);continue}r[i].push(e)}return{name:e,positionalArgs:n,namedArgs:r}},L=async e=>{switch(e.name){case`help`:{let t=e.positionalArgs[0]||`help`,n=d[t];if(n===void 0){Q(`Command not found: ${t}`);break}let r=F(t,n);Q(r);break}case`connect`:try{await l()||Q(`No controller selected.`)}catch(e){e instanceof Error&&Q(`Error: ${e.message}`)}break;case`disconnect`:try{await ee()||Q(t)}catch(e){e instanceof Error&&Q(`Error: ${e.message}`)}break;case`SendBytes`:{let t=[];for(let n=0;n<i;n++){let r=e.positionalArgs[n];t[n]=r===void 0?0:parseInt(r,10)}let n=new Uint8Array(t);try{let e=await s(n),t=[];for(let n=0;n<e.byteLength;n++)t[n]=e.getUint8(n).toString(10).toUpperCase();Q(t.join(` `))}catch(e){typeof e==`string`&&Q(e)}break}case`ReceiveBytes`:{let t=[[`Timestamp`,...Array.from({length:a},(e,t)=>t.toString(10))]],n=e.namedArgs.output?.[0],r=e.namedArgs.limit?.[0],i=r===void 0?1/0:parseInt(r,10);try{let e=!1,r=()=>{e=!0};A(r);for(let r=0;r<i&&!e;r++){let e=await c(),r=[];for(let t=0;t<Math.floor(e.byteLength/4);t++)r[t]=e.getFloat32(t*4,!0).toString(10);n!==void 0&&t.push([Date.now().toString(10),...r]),Q(r.join(` `))}j(r)}catch(e){typeof e==`string`&&Q(e)}if(n!==void 0&&t.length>0){let e=`data:text/csv;charset=utf-8,`+t.map(e=>e.join(`,`)).join(`
`),r=encodeURI(e),i=document.createElement(`a`);i.setAttribute(`href`,r),i.setAttribute(`download`,n),document.body.appendChild(i),i.click(),document.body.removeChild(i)}break}default:Q(`Unknown command: ${e.name}`);break}},R=async()=>{let e=y.join(``).trim();if(Z(),$(e),e){N(e),x=null;let t=I();typeof t==`string`?Q(t):await L(t)}y=[``,``],X(),q()},z=e=>e.replaceAll(`&`,`&amp;`).replaceAll(`<`,`&lt;`).replaceAll(`>`,`&gt;`).replaceAll(`"`,`&quot;`).replaceAll(`'`,`&#039;`),B=e=>{y[0]+=z(e),q()},V=()=>{let e=y[0],t=e.length-1;/&[^;]*;$/.test(e)&&(t=e.split(``).findLastIndex(e=>e===`&`)),y[0]=e.slice(0,t),q()},H=()=>{let e=T(),t=y[0].length+1;if(e[t-1]===`&`&&/^&[^;]*;/.test(y[1]))for(;e[t-1]!==`;`;t++);y=[e.slice(0,t),e.slice(t)],q()},U=()=>{let e=T(),t=Math.max(0,y[0].length-1);if(e[t]===`;`&&/&[^;]*;$/.test(y[0]))for(;e[t]!==`&`;t--);y=[e.slice(0,t),e.slice(t)],q()},W=e=>{let t=E(),n=t[0],r=Object.keys(d);if(n===void 0)return r;if(e===0)return r.filter(e=>e.startsWith(n));if(n===`help`&&e===1)return r.filter(e=>e.startsWith(t[1]||``));let i=d[n];if(i===void 0)return[];let a=new Set(Object.keys(i).filter(e=>!w(e))),o=t[e];for(let e of t){if(e===o||!e.startsWith(`--`))continue;let t=e.slice(2);a.delete(t)}let s=[...a].map(e=>`--${e}`);return o.startsWith(`-`)?s.filter(e=>e.startsWith(o)):s},G=(e,t)=>{let n=E(),r=n.slice(0,t),i=n.slice(t+1);return[[...r,e].join(` `)+(i.length>0?` `:``),i.join(` `)]},K=()=>y=[y[0].trimStart().split(/\s+/).join(` `),y[1].split(/\s+/).join(` `)],q=()=>{if(v===null)return;K();let e=`<span id="${ne}">${y[0]}<span id="${p}">&nbsp;</span></span>`,t=`<span>${y[1]}</span>`;v.innerHTML=`${e}${t}`,h.scrollTop=h.scrollHeight},J=e=>{if(e.ctrlKey&&e.key===`c`){k();return}if(!(e.altKey||e.metaKey||e.ctrlKey))switch(e.key){case`Enter`:e.stopPropagation(),e.preventDefault(),R();break;case`Backspace`:e.stopPropagation(),e.preventDefault(),V();break;case`ArrowLeft`:e.stopPropagation(),e.preventDefault(),U();break;case`ArrowRight`:e.stopPropagation(),e.preventDefault(),H();break;case`ArrowUp`:e.stopPropagation(),e.preventDefault(),P(-1);break;case`ArrowDown`:e.stopPropagation(),e.preventDefault(),P(1);break;case`Tab`:{e.stopPropagation(),e.preventDefault();let t=re(),n=W(t);if(n.length===0)break;if(n.length===1){y=G(n[0],t),q();break}let r=T();Z(),$(r),Q(n.join(` `)),X(),q();break}case`Shift`:break;case`Escape`:break;case`CapsLock`:break;default:B(e.key);break}},Y=e=>{e.stopPropagation(),e.preventDefault();let t=e.clipboardData?.getData(`text/plain`);t!==void 0&&B(t)},ie=()=>{let e=g;if(g=h.scrollTop,h.scrollHeight-h.scrollTop-h.clientHeight<5&&h.scrollTop>=e){_=!0,h.scrollTop=h.scrollHeight;return}h.scrollTop<e&&(_=!1)},X=()=>{let e=document.createElement(`span`);e.className=m;let t=document.createElement(`span`);t.innerHTML=`${C()}`,e.appendChild(t),v=document.createElement(`span`),v.addEventListener(`keydown`,J),e.appendChild(v),h.appendChild(e),v.focus()},Z=()=>{v?.removeEventListener(`keydown`,J),v?.parentElement?.remove(),v=null},Q=e=>{let t=document.createElement(`span`);t.className=m,t.innerHTML=e,h.appendChild(t),_&&(h.scrollTop=h.scrollHeight)},$=e=>{Q(`${C()}${e}`)};document.body.addEventListener(`keydown`,J),document.body.addEventListener(`paste`,Y),h.addEventListener(`scroll`,ie),X(),q();